<!DOCTYPE html>
<html>
<head>

<script src=""></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.16.1/vis.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.16.1/vis.min.css"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.8/es5-shim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.35.1/es6-shim.min.js"></script>

<script>

// Global vars

var quartets = {}; // dictionary
var singers = {}; // dictionary

// Read the CSV file and build a network graph model
Papa.parse("https://raw.githubusercontent.com/liwenyip/6-degrees-of-barbershop/master/BABS%20Quartet%20Singers.csv", {
 download: true,
 complete: function(results) {
  // compile unique lists of quartets, singers, and relationships
  $.each(results.data, function(i, row) {
    q = row[0];
    s = row[1];
    // create the quartet and singer if they don't exist
    if (!quartets.hasOwnProperty(q)) quartets[q] = {name:q, type:"q", links:[]};
    if (!singers.hasOwnProperty(s))  singers[s]  = {name:s, type:"s", links:[]};
    // create links between quartet and singer (but don't create duplicates)
    if ($.inArray(singers[s], quartets[q].links) == -1) quartets[q].links.push(singers[s]);
    if ($.inArray(quartets[q], singers[s].links) == -1) singers[s].links.push(quartets[q]);
  });
  // Set autocomplete on input
  $( "#singer" ).autocomplete({
    source: Object.keys(singers)
  });
  // debug
  console.log(quartets);
  console.log(singers);
 }
});

// Make a graph
$(function() {
  $( "#go" ).click(function() {
  // debug
  console.log("Building model...");
  // initialise lists
  toVisit = [singers[$("#singer").val()]];  // queue of nodes to be visited
  visited = [] // list of nodes that have been visited
  graphNodes = []; 
  graphLinks = []; 
  // create a network, starting with the selected Singer
  // Do a breadth-first search from the root node
  while (toVisit.length > 0) {
    // get the next node to visit, mark it as visited
    node = toVisit.shift()
    visited.push(node);
    // create a copy of the node and add it to the graph
    graphNodes.push({id:node.name, label:node.name, group:node.type});
    // loop through linked nodes
    $.each(node.links, function(i, link) {
      if ($.inArray(link, visited) != -1) return true; // skip linked nodes we've already visited
      if ($.inArray(link, toVisit) != -1) return true; // skip linked nodes we've already checked
      graphLinks.push({from:node.name, to:link.name}); // add link (edge) to the graph
      toVisit.push(link); // add linked node to list to visit
    });
  }
  // Change the group of the first node
  graphNodes[0].group = "Root Node";
  // debug
  console.log("Visualising...");
  // Do the visualisation stuff
  var container = document.getElementById('network');
  var data = {
    nodes: new vis.DataSet(graphNodes.slice(0,150)),
    edges: new vis.DataSet(graphLinks)
  };
  var options = {};
  var network = new vis.Network(container, data, options);
  console.log("Done...");
  });
});

</script>

  <style type="text/css">
    #network {
      width: 100%;
      height: 800px;
      border: 1px solid lightgray;
    }
  </style>

</head>
<body>

<h2>Six Degrees of Barbershop</h2>

<div class="ui-widget">
  <label for="singer">Singer: </label>
  <input id="singer">
  <button id="go">Go!</button>
</div>

<div id="network"></div>

</body>
</html>